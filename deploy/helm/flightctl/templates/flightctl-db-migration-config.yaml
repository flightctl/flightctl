apiVersion: v1
kind: ConfigMap
metadata:
  name: flightctl-db-migration-config
  namespace: {{ default .Release.Namespace .Values.global.internalNamespace }}
data:
  config.yaml: |-
    database:
        hostname: {{ include "flightctl.dbHostname" . }}
        type: {{ required "Values.db.type is required" $.Values.db.type | quote }}
        port: {{ required "Values.db.port is required" $.Values.db.port }}
        name: {{ required "Values.db.name is required" $.Values.db.name }}
        user: {{ (default "flightctl_migrator" $.Values.db.migrationUser) }}
        migrationUser: {{ (default "flightctl_migrator" $.Values.db.migrationUser) }}
        {{- if .Values.db.sslmode }}
        sslmode: {{ .Values.db.sslmode | quote }}
        {{- end }}
        {{- if .Values.db.sslcert }}
        sslcert: {{ .Values.db.sslcert | quote }}
        {{- end }}
        {{- if .Values.db.sslkey }}
        sslkey: {{ .Values.db.sslkey | quote }}
        {{- end }}
        {{- if .Values.db.sslrootcert }}
        sslrootcert: {{ .Values.db.sslrootcert | quote }}
        {{- end }}
    service: {}
    {{ if .Values.global.tracing.enabled }}
    tracing:
        enabled: true
        endpoint: {{ .Values.global.tracing.endpoint }}
        insecure: {{ .Values.global.tracing.insecure }}
    {{ end }}
