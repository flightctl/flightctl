version: '4.4'

services:
  flightctl-db:
    container_name: flightctl-db
    image: quay.io/cloudservices/postgresql-rds:12-9ee2984
    environment:
      - POSTGRESQL_DATABASE=flightctl
      - POSTGRESQL_USER=demouser
      - POSTGRESQL_PASSWORD=demopass
      - POSTGRESQL_MASTER_USER=admin
      - POSTGRESQL_MASTER_PASSWORD=adminpass
      - PGPASSWORD=adminpass
    ports:
      - "5432:5432"
    volumes:
      - flightctl-db:/var/lib/pgsql/data
    networks:
      - flightctl-network
    restart: always

  flightctl-server:
    container_name: flightctl-server
    image: localhost/flightctl-server:latest
    ports:
      - "3333:3333"
    restart: always
    volumes:
      - flightctl-server-certs:/root/.flightctl/certs/
      - ./config.yaml:/root/.flightctl/config.yaml
    networks:
      - flightctl-network
volumes:
  flightctl-db:
  flightctl-server-certs:
  config:
    external: true
networks:
  flightctl-network:
