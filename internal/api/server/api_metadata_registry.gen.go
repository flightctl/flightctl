// Code generated by api-metadata-extractor. DO NOT EDIT.

package server

import (
	"net/http"
	"strings"
	"time"

	"github.com/go-chi/chi/v5"
)

// EndpointMetadataVersion contains version-specific information for an endpoint
type EndpointMetadataVersion struct {
	Version      string     // e.g., "v1", "v1beta1"
	DeprecatedAt *time.Time // nil if not deprecated; interpreted as 00:00:00 UTC
}

// EndpointMetadata contains metadata for an API endpoint
type EndpointMetadata struct {
	OperationID string
	Resource    string                    // empty = fixed-contract
	Action      string                    // x-rbac.action, else inferred from method/pattern
	Versions    []EndpointMetadataVersion // Ordered by preference (stable > beta > alpha)
}
const (
	API_RESOURCE_AUTHPROVIDERS = "authproviders"
	API_RESOURCE_CATALOGS = "catalogs"
	API_RESOURCE_CATALOGS_ITEMS = "catalogs/items"
	API_RESOURCE_CERTIFICATESIGNINGREQUESTS = "certificatesigningrequests"
	API_RESOURCE_CERTIFICATESIGNINGREQUESTS_APPROVAL = "certificatesigningrequests/approval"
	API_RESOURCE_DEVICES = "devices"
	API_RESOURCE_DEVICES_DECOMMISSION = "devices/decommission"
	API_RESOURCE_DEVICES_LASTSEEN = "devices/lastseen"
	API_RESOURCE_DEVICES_RENDERED = "devices/rendered"
	API_RESOURCE_DEVICES_RESUME = "devices/resume"
	API_RESOURCE_DEVICES_STATUS = "devices/status"
	API_RESOURCE_ENROLLMENTREQUESTS = "enrollmentrequests"
	API_RESOURCE_ENROLLMENTREQUESTS_APPROVAL = "enrollmentrequests/approval"
	API_RESOURCE_ENROLLMENTREQUESTS_STATUS = "enrollmentrequests/status"
	API_RESOURCE_EVENTS = "events"
	API_RESOURCE_FLEETS = "fleets"
	API_RESOURCE_FLEETS_STATUS = "fleets/status"
	API_RESOURCE_FLEETS_TEMPLATEVERSIONS = "fleets/templateversions"
	API_RESOURCE_LABELS = "labels"
	API_RESOURCE_ORGANIZATIONS = "organizations"
	API_RESOURCE_REPOSITORIES = "repositories"
	API_RESOURCE_RESOURCESYNCS = "resourcesyncs"
)
const (
	API_ACTION_CREATE = "create"
	API_ACTION_DELETE = "delete"
	API_ACTION_GET = "get"
	API_ACTION_LIST = "list"
	API_ACTION_PATCH = "patch"
	API_ACTION_UPDATE = "update"
)
// timePtr is a helper to create time.Time pointers
func timePtr(year, month, day int) *time.Time {
	t := time.Date(year, time.Month(month), day, 0, 0, 0, 0, time.UTC)
	return &t
}

// ServerURLPrefixes lists normalized OpenAPI server URL path prefixes.
var ServerURLPrefixes = []string{
	"/api/v1",
}

// APIMetadataMap provides O(1) lookup for endpoint metadata using pattern+method as key
var APIMetadataMap = map[string]EndpointMetadata{
	"GET:/auth/config": {
		OperationID: "authConfig",
		Resource:    "",
		Action:      "list",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/auth/permissions": {
		OperationID: "authGetPermissions",
		Resource:    "",
		Action:      "list",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/auth/userinfo": {
		OperationID: "authUserInfo",
		Resource:    "",
		Action:      "list",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/auth/validate": {
		OperationID: "authValidate",
		Resource:    "",
		Action:      "list",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"POST:/auth/{providername}/token": {
		OperationID: "authToken",
		Resource:    "",
		Action:      "create",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/authproviders": {
		OperationID: "listAuthProviders",
		Resource:    "authproviders",
		Action:      "list",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"POST:/authproviders": {
		OperationID: "createAuthProvider",
		Resource:    "authproviders",
		Action:      "create",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"DELETE:/authproviders/{name}": {
		OperationID: "deleteAuthProvider",
		Resource:    "authproviders",
		Action:      "delete",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/authproviders/{name}": {
		OperationID: "getAuthProvider",
		Resource:    "authproviders",
		Action:      "get",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"PATCH:/authproviders/{name}": {
		OperationID: "patchAuthProvider",
		Resource:    "authproviders",
		Action:      "patch",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"PUT:/authproviders/{name}": {
		OperationID: "replaceAuthProvider",
		Resource:    "authproviders",
		Action:      "update",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/catalogs": {
		OperationID: "listCatalogs",
		Resource:    "catalogs",
		Action:      "list",
		Versions: []EndpointMetadataVersion{
			{Version: "v1alpha1", DeprecatedAt: nil},
		},
	},
	"POST:/catalogs": {
		OperationID: "createCatalog",
		Resource:    "catalogs",
		Action:      "create",
		Versions: []EndpointMetadataVersion{
			{Version: "v1alpha1", DeprecatedAt: nil},
		},
	},
	"GET:/catalogs/{catalog}/items": {
		OperationID: "listCatalogItems",
		Resource:    "catalogs/items",
		Action:      "get",
		Versions: []EndpointMetadataVersion{
			{Version: "v1alpha1", DeprecatedAt: nil},
		},
	},
	"POST:/catalogs/{catalog}/items": {
		OperationID: "createCatalogItem",
		Resource:    "catalogs/items",
		Action:      "create",
		Versions: []EndpointMetadataVersion{
			{Version: "v1alpha1", DeprecatedAt: nil},
		},
	},
	"DELETE:/catalogs/{catalog}/items/{name}": {
		OperationID: "deleteCatalogItem",
		Resource:    "catalogs/items",
		Action:      "delete",
		Versions: []EndpointMetadataVersion{
			{Version: "v1alpha1", DeprecatedAt: nil},
		},
	},
	"GET:/catalogs/{catalog}/items/{name}": {
		OperationID: "getCatalogItem",
		Resource:    "catalogs/items",
		Action:      "get",
		Versions: []EndpointMetadataVersion{
			{Version: "v1alpha1", DeprecatedAt: nil},
		},
	},
	"PUT:/catalogs/{catalog}/items/{name}": {
		OperationID: "replaceCatalogItem",
		Resource:    "catalogs/items",
		Action:      "update",
		Versions: []EndpointMetadataVersion{
			{Version: "v1alpha1", DeprecatedAt: nil},
		},
	},
	"DELETE:/catalogs/{name}": {
		OperationID: "deleteCatalog",
		Resource:    "catalogs",
		Action:      "delete",
		Versions: []EndpointMetadataVersion{
			{Version: "v1alpha1", DeprecatedAt: nil},
		},
	},
	"GET:/catalogs/{name}": {
		OperationID: "getCatalog",
		Resource:    "catalogs",
		Action:      "get",
		Versions: []EndpointMetadataVersion{
			{Version: "v1alpha1", DeprecatedAt: nil},
		},
	},
	"PATCH:/catalogs/{name}": {
		OperationID: "patchCatalog",
		Resource:    "catalogs",
		Action:      "patch",
		Versions: []EndpointMetadataVersion{
			{Version: "v1alpha1", DeprecatedAt: nil},
		},
	},
	"PUT:/catalogs/{name}": {
		OperationID: "replaceCatalog",
		Resource:    "catalogs",
		Action:      "update",
		Versions: []EndpointMetadataVersion{
			{Version: "v1alpha1", DeprecatedAt: nil},
		},
	},
	"GET:/catalogs/{name}/status": {
		OperationID: "getCatalogStatus",
		Resource:    "catalogs",
		Action:      "get",
		Versions: []EndpointMetadataVersion{
			{Version: "v1alpha1", DeprecatedAt: nil},
		},
	},
	"PATCH:/catalogs/{name}/status": {
		OperationID: "patchCatalogStatus",
		Resource:    "catalogs",
		Action:      "patch",
		Versions: []EndpointMetadataVersion{
			{Version: "v1alpha1", DeprecatedAt: nil},
		},
	},
	"PUT:/catalogs/{name}/status": {
		OperationID: "replaceCatalogStatus",
		Resource:    "catalogs",
		Action:      "update",
		Versions: []EndpointMetadataVersion{
			{Version: "v1alpha1", DeprecatedAt: nil},
		},
	},
	"GET:/certificatesigningrequests": {
		OperationID: "listCertificateSigningRequests",
		Resource:    "certificatesigningrequests",
		Action:      "list",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"POST:/certificatesigningrequests": {
		OperationID: "createCertificateSigningRequest",
		Resource:    "certificatesigningrequests",
		Action:      "create",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"DELETE:/certificatesigningrequests/{name}": {
		OperationID: "deleteCertificateSigningRequest",
		Resource:    "certificatesigningrequests",
		Action:      "delete",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/certificatesigningrequests/{name}": {
		OperationID: "getCertificateSigningRequest",
		Resource:    "certificatesigningrequests",
		Action:      "get",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"PATCH:/certificatesigningrequests/{name}": {
		OperationID: "patchCertificateSigningRequest",
		Resource:    "certificatesigningrequests",
		Action:      "patch",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"PUT:/certificatesigningrequests/{name}": {
		OperationID: "replaceCertificateSigningRequest",
		Resource:    "certificatesigningrequests",
		Action:      "update",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"PUT:/certificatesigningrequests/{name}/approval": {
		OperationID: "updateCertificateSigningRequestApproval",
		Resource:    "certificatesigningrequests/approval",
		Action:      "update",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"POST:/deviceactions/resume": {
		OperationID: "resumeDevices",
		Resource:    "devices/resume",
		Action:      "update",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/devices": {
		OperationID: "listDevices",
		Resource:    "devices",
		Action:      "list",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"POST:/devices": {
		OperationID: "createDevice",
		Resource:    "devices",
		Action:      "create",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"DELETE:/devices/{name}": {
		OperationID: "deleteDevice",
		Resource:    "devices",
		Action:      "delete",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/devices/{name}": {
		OperationID: "getDevice",
		Resource:    "devices",
		Action:      "get",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"PATCH:/devices/{name}": {
		OperationID: "patchDevice",
		Resource:    "devices",
		Action:      "patch",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"PUT:/devices/{name}": {
		OperationID: "replaceDevice",
		Resource:    "devices",
		Action:      "update",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"PUT:/devices/{name}/decommission": {
		OperationID: "decommissionDevice",
		Resource:    "devices/decommission",
		Action:      "update",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/devices/{name}/lastseen": {
		OperationID: "getDeviceLastSeen",
		Resource:    "devices/lastseen",
		Action:      "get",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/devices/{name}/rendered": {
		OperationID: "getRenderedDevice",
		Resource:    "devices/rendered",
		Action:      "get",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/devices/{name}/status": {
		OperationID: "getDeviceStatus",
		Resource:    "devices/status",
		Action:      "get",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"PATCH:/devices/{name}/status": {
		OperationID: "patchDeviceStatus",
		Resource:    "devices/status",
		Action:      "patch",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"PUT:/devices/{name}/status": {
		OperationID: "replaceDeviceStatus",
		Resource:    "devices/status",
		Action:      "update",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/enrollmentconfig": {
		OperationID: "getEnrollmentConfig",
		Resource:    "",
		Action:      "list",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/enrollmentrequests": {
		OperationID: "listEnrollmentRequests",
		Resource:    "enrollmentrequests",
		Action:      "list",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"POST:/enrollmentrequests": {
		OperationID: "createEnrollmentRequest",
		Resource:    "enrollmentrequests",
		Action:      "create",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"DELETE:/enrollmentrequests/{name}": {
		OperationID: "deleteEnrollmentRequest",
		Resource:    "enrollmentrequests",
		Action:      "delete",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/enrollmentrequests/{name}": {
		OperationID: "getEnrollmentRequest",
		Resource:    "enrollmentrequests",
		Action:      "get",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"PATCH:/enrollmentrequests/{name}": {
		OperationID: "patchEnrollmentRequest",
		Resource:    "enrollmentrequests",
		Action:      "patch",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"PUT:/enrollmentrequests/{name}": {
		OperationID: "replaceEnrollmentRequest",
		Resource:    "enrollmentrequests",
		Action:      "update",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"PUT:/enrollmentrequests/{name}/approval": {
		OperationID: "approveEnrollmentRequest",
		Resource:    "enrollmentrequests/approval",
		Action:      "update",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/enrollmentrequests/{name}/status": {
		OperationID: "getEnrollmentRequestStatus",
		Resource:    "enrollmentrequests/status",
		Action:      "get",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"PATCH:/enrollmentrequests/{name}/status": {
		OperationID: "patchEnrollmentRequestStatus",
		Resource:    "enrollmentrequests/status",
		Action:      "patch",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"PUT:/enrollmentrequests/{name}/status": {
		OperationID: "replaceEnrollmentRequestStatus",
		Resource:    "enrollmentrequests/status",
		Action:      "update",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/events": {
		OperationID: "listEvents",
		Resource:    "events",
		Action:      "list",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/fleets": {
		OperationID: "listFleets",
		Resource:    "fleets",
		Action:      "list",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"POST:/fleets": {
		OperationID: "createFleet",
		Resource:    "fleets",
		Action:      "create",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/fleets/{fleet}/templateversions": {
		OperationID: "listTemplateVersions",
		Resource:    "fleets/templateversions",
		Action:      "get",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"DELETE:/fleets/{fleet}/templateversions/{name}": {
		OperationID: "deleteTemplateVersion",
		Resource:    "fleets/templateversions",
		Action:      "delete",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/fleets/{fleet}/templateversions/{name}": {
		OperationID: "getTemplateVersion",
		Resource:    "fleets/templateversions",
		Action:      "get",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"DELETE:/fleets/{name}": {
		OperationID: "deleteFleet",
		Resource:    "fleets",
		Action:      "delete",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/fleets/{name}": {
		OperationID: "getFleet",
		Resource:    "fleets",
		Action:      "get",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"PATCH:/fleets/{name}": {
		OperationID: "patchFleet",
		Resource:    "fleets",
		Action:      "patch",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"PUT:/fleets/{name}": {
		OperationID: "replaceFleet",
		Resource:    "fleets",
		Action:      "update",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/fleets/{name}/status": {
		OperationID: "getFleetStatus",
		Resource:    "fleets/status",
		Action:      "get",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"PATCH:/fleets/{name}/status": {
		OperationID: "patchFleetStatus",
		Resource:    "fleets/status",
		Action:      "patch",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"PUT:/fleets/{name}/status": {
		OperationID: "replaceFleetStatus",
		Resource:    "fleets/status",
		Action:      "update",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/labels": {
		OperationID: "listLabels",
		Resource:    "labels",
		Action:      "list",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/organizations": {
		OperationID: "listOrganizations",
		Resource:    "organizations",
		Action:      "list",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/repositories": {
		OperationID: "listRepositories",
		Resource:    "repositories",
		Action:      "list",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"POST:/repositories": {
		OperationID: "createRepository",
		Resource:    "repositories",
		Action:      "create",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"DELETE:/repositories/{name}": {
		OperationID: "deleteRepository",
		Resource:    "repositories",
		Action:      "delete",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/repositories/{name}": {
		OperationID: "getRepository",
		Resource:    "repositories",
		Action:      "get",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"PATCH:/repositories/{name}": {
		OperationID: "patchRepository",
		Resource:    "repositories",
		Action:      "patch",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"PUT:/repositories/{name}": {
		OperationID: "replaceRepository",
		Resource:    "repositories",
		Action:      "update",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/resourcesyncs": {
		OperationID: "listResourceSyncs",
		Resource:    "resourcesyncs",
		Action:      "list",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"POST:/resourcesyncs": {
		OperationID: "createResourceSync",
		Resource:    "resourcesyncs",
		Action:      "create",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"DELETE:/resourcesyncs/{name}": {
		OperationID: "deleteResourceSync",
		Resource:    "resourcesyncs",
		Action:      "delete",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/resourcesyncs/{name}": {
		OperationID: "getResourceSync",
		Resource:    "resourcesyncs",
		Action:      "get",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"PATCH:/resourcesyncs/{name}": {
		OperationID: "patchResourceSync",
		Resource:    "resourcesyncs",
		Action:      "patch",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"PUT:/resourcesyncs/{name}": {
		OperationID: "replaceResourceSync",
		Resource:    "resourcesyncs",
		Action:      "update",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
	"GET:/version": {
		OperationID: "getVersion",
		Resource:    "",
		Action:      "list",
		Versions: []EndpointMetadataVersion{
			{Version: "v1beta1", DeprecatedAt: nil},
		},
	},
}

// GetEndpointMetadata returns endpoint metadata even when routes are mounted under
// a base prefix like /api/v1 by normalizing and matching request paths.
func GetEndpointMetadata(r *http.Request) *EndpointMetadata {
	rctx := chi.RouteContext(r.Context())
	if rctx != nil {
		if metadata := lookupMetadata(r.Method, rctx.RoutePath); metadata != nil {
			return metadata
		}
	}

	return lookupMetadata(r.Method, r.URL.Path)
}

func normalizePath(p string) string {
	if p == "" {
		return "/"
	}
	if len(p) > 1 && strings.HasSuffix(p, "/") {
		p = strings.TrimSuffix(p, "/")
	}
	if !strings.HasPrefix(p, "/") {
		p = "/" + p
	}
	return p
}

func lookupMetadata(method, path string) *EndpointMetadata {
	candidates := normalizeCandidates(path)
	if len(candidates) == 0 {
		return nil
	}
	for _, candidate := range candidates {
		key := method + ":" + candidate
		if metadata, exists := APIMetadataMap[key]; exists {
			return &metadata
		}
	}

	methodPrefix := method + ":"
	for key, metadata := range APIMetadataMap {
		if !strings.HasPrefix(key, methodPrefix) {
			continue
		}
		pattern := strings.TrimPrefix(key, methodPrefix)
		for _, candidate := range candidates {
			if matchTemplatePath(pattern, candidate) {
				return &metadata
			}
		}
	}
	return nil
}

func normalizeCandidates(path string) []string {
	base := normalizePath(path)
	candidates := make([]string, 0, 1+len(ServerURLPrefixes))
	seen := map[string]struct{}{}
	addCandidate := func(p string) {
		if p == "" {
			return
		}
		if _, exists := seen[p]; exists {
			return
		}
		seen[p] = struct{}{}
		candidates = append(candidates, p)
	}

	addCandidate(base)
	for _, prefix := range ServerURLPrefixes {
		if prefix == "/" {
			continue
		}
		if base == prefix {
			addCandidate("/")
			continue
		}
		if strings.HasPrefix(base, prefix+"/") {
			stripped := strings.TrimPrefix(base, prefix)
			addCandidate(normalizePath(stripped))
		}
	}
	return candidates
}

func matchTemplatePath(pattern, path string) bool {
	pattern = normalizePath(pattern)
	path = normalizePath(path)

	pSegs := splitPath(pattern)
	pathSegs := splitPath(path)
	if len(pSegs) != len(pathSegs) {
		return false
	}
	for i := range pSegs {
		ps := pSegs[i]
		if len(ps) >= 2 && ps[0] == '{' && ps[len(ps)-1] == '}' {
			continue
		}
		if ps != pathSegs[i] {
			return false
		}
	}
	return true
}

func splitPath(p string) []string {
	p = strings.Trim(p, "/")
	if p == "" {
		return nil
	}
	parts := strings.Split(p, "/")
	out := make([]string, 0, len(parts))
	for _, part := range parts {
		if part == "" {
			continue
		}
		out = append(out, part)
	}
	return out
}

