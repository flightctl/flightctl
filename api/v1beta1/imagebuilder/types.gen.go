// Package imagebuilder provides primitives to interact with the openapi HTTP API.
//
// Code generated by github.com/oapi-codegen/oapi-codegen/v2 version v2.3.0 DO NOT EDIT.
package imagebuilder

import (
	"encoding/json"
	"errors"
	"time"

	externalRef0 "github.com/flightctl/flightctl/api/v1beta1"
	"github.com/oapi-codegen/runtime"
)

// Defines values for BindingType.
const (
	BindingTypeEarly BindingType = "early"
	BindingTypeLate  BindingType = "late"
)

// Defines values for EarlyBindingType.
const (
	Early EarlyBindingType = "early"
)

// Defines values for ImageBuildPhase.
const (
	ImageBuildPhaseBuilding ImageBuildPhase = "building"
	ImageBuildPhaseComplete ImageBuildPhase = "complete"
	ImageBuildPhaseFailed   ImageBuildPhase = "failed"
	ImageBuildPhasePushing  ImageBuildPhase = "pushing"
	ImageBuildPhaseQueued   ImageBuildPhase = "queued"
)

// Defines values for LateBindingType.
const (
	Late LateBindingType = "late"
)

// BindingType The type of binding for the image build.
type BindingType string

// EarlyBinding Early binding configuration - embeds certificate in the image.
type EarlyBinding struct {
	// CertName Name of the enrollment certificate resource to embed in the image for device binding.
	CertName string `json:"certName"`

	// Type The type of binding.
	Type EarlyBindingType `json:"type"`
}

// EarlyBindingType The type of binding.
type EarlyBindingType string

// ImageBuild ImageBuild represents a build request for a container image.
type ImageBuild struct {
	// ApiVersion APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources.
	ApiVersion string `json:"apiVersion"`

	// Kind Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds.
	Kind string `json:"kind"`

	// Metadata ObjectMeta is metadata that all persisted resources must have, which includes all objects users must create.
	Metadata externalRef0.ObjectMeta `json:"metadata"`

	// Spec ImageBuildSpec describes the specification for an image build.
	Spec ImageBuildSpec `json:"spec"`

	// Status ImageBuildStatus represents the current status of an ImageBuild.
	Status *ImageBuildStatus `json:"status,omitempty"`
}

// ImageBuildBinding ImageBuildBinding specifies binding configuration for the build.
type ImageBuildBinding struct {
	union json.RawMessage
}

// ImageBuildDestination ImageBuildDestination specifies the destination for the built image.
type ImageBuildDestination struct {
	// ImageName The name of the output image.
	ImageName string `json:"imageName"`

	// Repository The name of the Repository resource of type OCI to push the built image to.
	Repository string `json:"repository"`

	// Tag The tag of the output image.
	Tag string `json:"tag"`
}

// ImageBuildList ImageBuildList is a list of ImageBuild resources.
type ImageBuildList struct {
	// ApiVersion APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources.
	ApiVersion string `json:"apiVersion"`

	// Items List of ImageBuild resources.
	Items []ImageBuild `json:"items"`

	// Kind Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds.
	Kind string `json:"kind"`

	// Metadata ListMeta describes metadata that synthetic resources must have, including lists and various status objects. A resource may have only one of {ObjectMeta, ListMeta}.
	Metadata externalRef0.ListMeta `json:"metadata"`
}

// ImageBuildPhase The phase of the image build process.
type ImageBuildPhase string

// ImageBuildSource ImageBuildSource specifies the source image for the build.
type ImageBuildSource struct {
	// ImageName The name of the source image.
	ImageName string `json:"imageName"`

	// ImageTag The tag of the source image.
	ImageTag string `json:"imageTag"`

	// Repository The name of the Repository resource of type OCI containing the source image.
	Repository string `json:"repository"`
}

// ImageBuildSpec ImageBuildSpec describes the specification for an image build.
type ImageBuildSpec struct {
	// Binding ImageBuildBinding specifies binding configuration for the build.
	Binding ImageBuildBinding `json:"binding"`

	// Destination ImageBuildDestination specifies the destination for the built image.
	Destination ImageBuildDestination `json:"destination"`

	// Source ImageBuildSource specifies the source image for the build.
	Source ImageBuildSource `json:"source"`
}

// ImageBuildStatus ImageBuildStatus represents the current status of an ImageBuild.
type ImageBuildStatus struct {
	// Architecture The architecture of the built image.
	Architecture *string `json:"architecture,omitempty"`

	// CompletedAt The time the build completed.
	CompletedAt *time.Time `json:"completedAt,omitempty"`

	// Conditions Current conditions of the ImageBuild.
	Conditions *[]externalRef0.Condition `json:"conditions,omitempty"`

	// Error Error message if the build failed.
	Error *string `json:"error,omitempty"`

	// ImageReference The full image reference of the built image (e.g., quay.io/org/imagename:tag).
	ImageReference *string `json:"imageReference,omitempty"`

	// LastSeen The last time the build was seen (heartbeat).
	LastSeen *time.Time `json:"lastSeen,omitempty"`

	// ManifestDigest The digest of the built image manifest.
	ManifestDigest *string `json:"manifestDigest,omitempty"`

	// Phase The phase of the image build process.
	Phase *ImageBuildPhase `json:"phase,omitempty"`

	// StartedAt The time the build started.
	StartedAt *time.Time `json:"startedAt,omitempty"`
}

// LateBinding Late binding configuration - device binds at first boot.
type LateBinding struct {
	// Type The type of binding.
	Type LateBindingType `json:"type"`
}

// LateBindingType The type of binding.
type LateBindingType string

// ListImageBuildsParams defines parameters for ListImageBuilds.
type ListImageBuildsParams struct {
	// LabelSelector A selector to restrict the list of returned objects by their labels.
	LabelSelector *string `form:"labelSelector,omitempty" json:"labelSelector,omitempty"`

	// FieldSelector A selector to restrict the list of returned objects by their fields.
	FieldSelector *string `form:"fieldSelector,omitempty" json:"fieldSelector,omitempty"`

	// Limit The maximum number of results returned in the list response.
	Limit *int32 `form:"limit,omitempty" json:"limit,omitempty"`

	// Continue An optional parameter to query more results from the server.
	Continue *string `form:"continue,omitempty" json:"continue,omitempty"`
}

// CreateImageBuildJSONRequestBody defines body for CreateImageBuild for application/json ContentType.
type CreateImageBuildJSONRequestBody = ImageBuild

// AsEarlyBinding returns the union data inside the ImageBuildBinding as a EarlyBinding
func (t ImageBuildBinding) AsEarlyBinding() (EarlyBinding, error) {
	var body EarlyBinding
	err := json.Unmarshal(t.union, &body)
	return body, err
}

// FromEarlyBinding overwrites any union data inside the ImageBuildBinding as the provided EarlyBinding
func (t *ImageBuildBinding) FromEarlyBinding(v EarlyBinding) error {
	v.Type = "early"
	b, err := json.Marshal(v)
	t.union = b
	return err
}

// MergeEarlyBinding performs a merge with any union data inside the ImageBuildBinding, using the provided EarlyBinding
func (t *ImageBuildBinding) MergeEarlyBinding(v EarlyBinding) error {
	v.Type = "early"
	b, err := json.Marshal(v)
	if err != nil {
		return err
	}

	merged, err := runtime.JSONMerge(t.union, b)
	t.union = merged
	return err
}

// AsLateBinding returns the union data inside the ImageBuildBinding as a LateBinding
func (t ImageBuildBinding) AsLateBinding() (LateBinding, error) {
	var body LateBinding
	err := json.Unmarshal(t.union, &body)
	return body, err
}

// FromLateBinding overwrites any union data inside the ImageBuildBinding as the provided LateBinding
func (t *ImageBuildBinding) FromLateBinding(v LateBinding) error {
	v.Type = "late"
	b, err := json.Marshal(v)
	t.union = b
	return err
}

// MergeLateBinding performs a merge with any union data inside the ImageBuildBinding, using the provided LateBinding
func (t *ImageBuildBinding) MergeLateBinding(v LateBinding) error {
	v.Type = "late"
	b, err := json.Marshal(v)
	if err != nil {
		return err
	}

	merged, err := runtime.JSONMerge(t.union, b)
	t.union = merged
	return err
}

func (t ImageBuildBinding) Discriminator() (string, error) {
	var discriminator struct {
		Discriminator string `json:"type"`
	}
	err := json.Unmarshal(t.union, &discriminator)
	return discriminator.Discriminator, err
}

func (t ImageBuildBinding) ValueByDiscriminator() (interface{}, error) {
	discriminator, err := t.Discriminator()
	if err != nil {
		return nil, err
	}
	switch discriminator {
	case "early":
		return t.AsEarlyBinding()
	case "late":
		return t.AsLateBinding()
	default:
		return nil, errors.New("unknown discriminator value: " + discriminator)
	}
}

func (t ImageBuildBinding) MarshalJSON() ([]byte, error) {
	b, err := t.union.MarshalJSON()
	return b, err
}

func (t *ImageBuildBinding) UnmarshalJSON(b []byte) error {
	err := t.union.UnmarshalJSON(b)
	return err
}
